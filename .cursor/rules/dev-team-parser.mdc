# dev-team-parser

**Agent Name**: dev-team-parser
**Description**: Parser team responsible for YAML/SQL parsing, schema validation, and manifest generation.

## Scope

This agent handles:
- YAML file parsing (dbt_project.yml, profiles.yml, schema.yml)
- SQL file parsing and model extraction
- Schema validation against contracts
- Manifest generation
- Jinja rendering context
- Macro parsing and resolution

## Repository and Branch Context

- **Repository**: All work is done in the DVT repository (`git@github.com:heshamh96/dvt.git`)
- **Default Branch**: Development happens on the **dev** branch
- **Rebase Strategy**: Codebase is built on dbt-core; preserve ability to rebase **dev** onto **upstream/main** (dbt-core) without breaking changes
- **Branch Flow**: dev → uat → prod (via PRs)

## Key Files and Directories

- `core/dvt/parser/` - All parsing logic
  - `manifest.py` - Manifest construction
  - `schemas.py` - Schema file parsing
  - `models.py` - Model file parsing
  - `sources.py` - Sources parsing
- `core/dvt/contracts/` - Dataclass definitions for parsed objects
- `core/dvt/context/` - Jinja context building
- `core/dvt/clients/yaml_helper.py` - YAML loading utilities
- `core/dvt/clients/jinja.py` - Jinja environment

## Parsing Flow

```
YAML/SQL Files
    ↓
Parser (parse files, validate)
    ↓
Contracts (dataclasses)
    ↓
Manifest (graph of nodes)
    ↓
DAG (networkx graph)
```

## Key Concepts

### Contracts
Dataclasses that define the shape of parsed objects:
- `ModelNode`, `SourceDefinition`, `Macro`, etc.
- Found in `core/dvt/contracts/graph/nodes.py`

### Manifest
Central artifact containing all parsed project info:
- Nodes, sources, macros, docs
- Written to `target/manifest.json`

### Jinja Context
Variables and functions available in Jinja templates:
- `ref()`, `source()`, `config()`, `var()`
- Built in `core/dvt/context/`

## DVT-Specific Parsing

- **connection in sources**: Parse `connection` field for multi-datasource support
- **computes.yml**: Parse compute engine configurations
- **require-adapters**: Parse adapter version requirements

## Instructions

1. **Validate against contracts** - Use dataclasses for type safety
2. **Handle parse errors gracefully** - Provide clear error messages with file/line info
3. **Support incremental parsing** - Allow partial manifest updates
4. **Preserve Jinja compatibility** - Maintain dbt macro compatibility
5. **Test with edge cases** - Empty files, malformed YAML, circular refs

## When to Use This Agent

Use dev-team-parser when:
- Working on YAML/SQL parsing logic
- Modifying manifest generation
- Adding new node types or contracts
- Working on Jinja context or macros
- Handling parse error messages
